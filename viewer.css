:root{
  --ui-radius:14px; --shadow:0 10px 30px rgba(0,0,0,.10); --accent:#111; --bg:#f6f7f9;
  --btn-b:#d6d9de; --btn-h:#c7ccd3; --ring:#6b7280; --error:#b00020;
  --anim-ms:650ms; --z-toolbar:10; --z-loading:15; --z-error:16;
}
html,body{height:100%}
body{
  margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  background:var(--bg);color:#111;-webkit-font-smoothing:antialiased;
  overscroll-behavior:contain;
}
.app{width:min(1000px,100%);padding:16px;margin:0 auto}

/* Toolbar */
.toolbar{
  position:sticky;top:8px;z-index:var(--z-toolbar);
  display:flex;align-items:center;justify-content:space-between;gap:12px;
  background:#fff;border-radius:var(--ui-radius);padding:10px 12px;box-shadow:var(--shadow)
}
.group{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
.divider{width:1px;height:28px;background:#e5e7eb}
.btn{
  appearance:none;border:1px solid var(--btn-b);background:#fff;color:#111;border-radius:10px;
  padding:10px 12px;font-size:14px;line-height:1;cursor:pointer;
  transition:transform .08s ease, background .2s ease, border-color .2s ease
}
.btn:hover{background:#fafafa}
.btn:active{transform:translateY(1px)}
.btn[disabled]{opacity:.45;cursor:not-allowed}
.select{border:1px solid var(--btn-b);border-radius:10px;padding:8px 10px;background:#fff}
.pagejump{
  display:flex;align-items:center;gap:6px;border:1px solid var(--btn-b);border-radius:10px;padding:6px 8px
}
.pagejump input{width:64px;border:0;outline:0;font:inherit;text-align:right}
.slash{opacity:.6;margin-inline:2px}
.mono{font-variant-numeric:tabular-nums}

/* Stage / flipbook */
.stage{
  position:relative;width:min(980px,96vw);margin:14px auto 0;
  aspect-ratio:3/4;background:#fff;border-radius:var(--ui-radius);box-shadow:var(--shadow);
  overflow:hidden;perspective:1600px;transform-style:preserve-3d
}
.sheet{
  position:absolute;inset:0;display:grid;place-items:center;
  transform-style:preserve-3d;backface-visibility:hidden;will-change:transform
}
canvas{display:block;width:100%;height:auto}
.shine{position:absolute;inset:0;pointer-events:none;mix-blend-mode:multiply;opacity:0}
.shine::before{
  content:"";position:absolute;inset:0;
  background:linear-gradient(90deg,rgba(0,0,0,0) 0%,rgba(0,0,0,.10) 50%,rgba(0,0,0,0) 100%);
  transform:translateX(-30%)
}

/* Animazioni pagina */
@keyframes turnLeftCurrent{from{transform:rotateY(0deg)}to{transform:rotateY(-180deg)}}
@keyframes turnLeftNext{from{transform:rotateY(180deg)}to{transform:rotateY(0deg)}}
@keyframes turnRightCurrent{from{transform:rotateY(0deg)}to{transform:rotateY(180deg)}}
@keyframes turnRightNext{from{transform:rotateY(-180deg)}to{transform:rotateY(0deg)}}
.book.anim-left .sheet.current{transform-origin:left center;animation:turnLeftCurrent var(--anim-ms) ease both;z-index:2}
.book.anim-left .sheet.next{transform-origin:right center;animation:turnLeftNext var(--anim-ms) ease both;z-index:1}
.book.anim-right .sheet.current{transform-origin:right center;animation:turnRightCurrent var(--anim-ms) ease both;z-index:2}
.book.anim-right .sheet.next{transform-origin:left center;animation:turnRightNext var(--anim-ms) ease both;z-index:1}
.book.anim-left .sheet.current .shine,.book.anim-right .sheet.current .shine{opacity:.8;transition:opacity calc(var(--anim-ms)*.8) ease}

@media (prefers-reduced-motion: reduce){
  .book.anim-left .sheet.current,.book.anim-right .sheet.current{animation:none}
  .book.anim-left .sheet.next,.book.anim-right .sheet.next{animation:none}
}

/* Loading + error */
.loading{
  position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;
  gap:12px;background:linear-gradient(180deg,rgba(255,255,255,.92),rgba(255,255,255,.86));
  z-index:var(--z-loading)
}
.spinner{width:26px;height:26px;border:3px solid #e5e7eb;border-top-color:#111;border-radius:50%;animation:spin .9s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.error{
  position:absolute;left:12px;right:12px;top:12px;padding:10px 12px;border:1px solid #fca5a5;background:#fee2e2;color:#7f1d1d;border-radius:12px;z-index:var(--z-error)
}
.hint{font-size:12px;color:#666;margin-top:6px}

/* Forza rimozione dal layout quando hidden Ã¨ presente */
.loading[hidden], .error[hidden]{ display:none !important; }

/* Debug tests (opzionali) */
.tests{margin-top:10px}
